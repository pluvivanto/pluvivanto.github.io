<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://pluvivanto.github.io/posts/weird-undefined-reference-cxx-14-vs-17/"><link href="/assets/main.94311a5a86dacb88dcee.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Weird undefined reference - CXX 14 vs 17 | Sand Castle</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Weird undefined reference - CXX 14 vs 17"><meta property="og:site_name" content="Sand Castle"><meta property="og:type" content="website"><meta property="og:url" content="https://pluvivanto.github.io//posts/weird-undefined-reference-cxx-14-vs-17/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Weird undefined reference - CXX 14 vs 17 31 Oct 2023 | 2 min read Lately, I&#39;ve been working on a project that involves migrating our..."><meta property="og:description" content="Weird undefined reference - CXX 14 vs 17 31 Oct 2023 | 2 min read Lately, I&#39;ve been working on a project that involves migrating our..."><meta name="description" content="Weird undefined reference - CXX 14 vs 17 31 Oct 2023 | 2 min read Lately, I&#39;ve been working on a project that involves migrating our..."><meta property="og:image" content="https://pluvivanto.github.io/images/default-social-image.png"><meta name="twitter:image" content="https://pluvivanto.github.io/images/default-social-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">Sand Castle</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Weird undefined reference - CXX 14 vs 17</h1><div class="post__details"><time datetime="2023-10-31">31 Oct 2023 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>Lately, I've been working on a project that involves migrating our C++17-based solution to an environment that relies on C++14. Honestly, I'm not entirely sure why a client would want such a downgrade, but the customer is king, right?</p><p>So, I went ahead and replaced all the features introduced in C++17, like <code>&lt;variant&gt;</code>, <code>&lt;filesystem&gt;</code>, inline variables, lambda capture of <code>*this</code>, <code>constexpr</code> lambdas, <code>__has_include</code>, and, regrettably, one of the most important ones, the <code>[[maybe_unused]]</code> attribute. Most of these changes went smoothly, but I ran into a peculiar issue: undefined references during linking. I was absolutely certain that everything was correctly declared, defined in the header files, and properly linked.</p><p>After several days (and a few sleepless nights) pulling my hair out, I finally pinpointed the root cause. The issue stemmed from <code>constexpr static</code> data members in the header files. To be more precise, it's due to the nuances of how C++ treats these members:</p><blockquote><p>A constexpr specifier used in an object declaration or non-static member function (until C++14) implies const. A constexpr specifier used in a function or static data member (since C++17) declaration implies inline. If any declaration of a function or function template has a constexpr specifier, then every declaration must contain that specifier.</p><p>- from <a href="https://en.cppreference.com/w/cpp/language/constexpr">cppreference</a></p></blockquote><blockquote><p>If a const non-inline (since C++17) static data member or a constexpr static data member (since C++11)(until C++17) is <a href="https://en.cppreference.com/w/cpp/language/definition#ODR-use">odr-used</a>, a definition at namespace scope is still required, but it cannot have an initializer.</p><p>A constexpr static data member is implicitly inline and does not need to be redeclared at namespace scope. This redeclaration without an initializer (formerly required) is still permitted, but is deprecated. (since C++17)</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">X</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>X<span class="token double-colon punctuation">::</span>n<span class="token punctuation">,</span> <span class="token operator">*</span>q <span class="token operator">=</span> <span class="token operator">&amp;</span>X<span class="token double-colon punctuation">::</span>m<span class="token punctuation">;</span> <span class="token comment">// X::n and X::m are odr-used</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> X<span class="token double-colon punctuation">::</span>n<span class="token punctuation">;</span>                   <span class="token comment">// … so a definition is necessary</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> X<span class="token double-colon punctuation">::</span>m<span class="token punctuation">;</span>               <span class="token comment">// … (except for X::m in C++17)</span></code></pre><p>- from <a href="https://en.cppreference.com/w/cpp/language/static">cppreference</a></p></blockquote><p>This means that I didn't have to re-declare <code>static const</code> and <code>static constexpr</code> member variables in corresponding <code>.cpp</code> files in C++17. But because I'm downgrading the project, I have to do it now.</p><p>So, I've solved one problem by re-declaring every <code>static constexpr</code> variable. But what happens when the class is templated? According to the <a href="https://isocpp.org/wiki/faq/templates#templates-defn-vs-decl">Standard C++ Foundation</a>, it's not advisable to split a templated class into declaration and definition.</p><p>I scoured for a more elegant, intuitive, and scalable solution but ended up removing the static keyword and creating an instance every time I needed to use the class. I wish I could come up with a better solution, but I don't believe this &quot;problem&quot; can be fixed without refactoring the entire legacy project. It's working, and I'm content with that for now.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/CXX/">#CXX</a></div><nav class="post__pagination"><a href="/posts/tdd:-test-driven-development-msa/"><span>←</span> <span>TDD: Test Driven Development – 한빛 MSA</span> </a><a href="/posts/application-configuration-in-java-spring:-application.properties-vs-application.yml/"><span>Application Configuration in Java Spring: application.properties vs application.yml</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/pluvivanto" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Created by <a href="https://twitter.com/yinkakun" target="_blank" rel="noopener">Yinka,</a> Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">11ty,</a> Checkout <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">project's github repo</a></p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>